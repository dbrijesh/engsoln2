# Cucumber BDD Reporting Guide

This document explains the Cucumber BDD test reporting setup and how to generate beautiful HTML reports.

## Table of Contents
- [Overview](#overview)
- [Report Types](#report-types)
- [Running Tests](#running-tests)
- [Viewing Reports](#viewing-reports)
- [Report Features](#report-features)
- [CI/CD Integration](#cicd-integration)
- [Sample Report](#sample-report)

## Overview

The backend application uses Cucumber for BDD (Behavior-Driven Development) testing with comprehensive reporting capabilities.

### Tools Used
- **Cucumber JVM 7.15.0** - BDD test framework
- **Masterthought Cucumber Reporting** - Beautiful HTML report generation
- **JUnit Platform** - Test execution engine
- **REST Assured** - API testing

## Report Types

### 1. Console Output (Pretty Print)
Real-time console output during test execution showing scenarios as they run.

### 2. JSON Report
Machine-readable JSON format for CI/CD integration and custom processing.
- **Location**: `target/cucumber-reports/cucumber.json`

### 3. Basic HTML Report
Simple HTML report generated directly by Cucumber.
- **Location**: `target/cucumber-reports/cucumber.html`

### 4. **Enhanced HTML Report** (Recommended)
Beautiful, interactive HTML report generated by Masterthought plugin.
- **Location**: `target/cucumber-reports/cucumber-html-reports/overview-features.html`

## Running Tests

### Run All BDD Tests

```bash
# Full build with integration tests
cd app/backend
mvn clean verify

# Run only integration tests
mvn verify -DskipUTs=true

# Run only BDD tests
mvn test -Dtest=CucumberRunnerTest
```

### Run Specific Scenarios by Tag

```bash
# Run only smoke tests
mvn verify -Dcucumber.filter.tags="@smoke"

# Run only positive tests
mvn verify -Dcucumber.filter.tags="@positive"

# Run validation tests
mvn verify -Dcucumber.filter.tags="@validation"

# Run everything except slow tests
mvn verify -Dcucumber.filter.tags="not @slow"

# Combine tags (smoke OR regression)
mvn verify -Dcucumber.filter.tags="@smoke or @regression"

# Combine tags (smoke AND positive)
mvn verify -Dcucumber.filter.tags="@smoke and @positive"
```

## Viewing Reports

### 1. Enhanced HTML Report (Recommended)

After running tests:
```bash
# Open the main report
open target/cucumber-reports/cucumber-html-reports/overview-features.html

# Or on Linux/Windows
xdg-open target/cucumber-reports/cucumber-html-reports/overview-features.html
start target/cucumber-reports/cucumber-html-reports/overview-features.html
```

### 2. Basic Cucumber HTML

```bash
open target/cucumber-reports/cucumber.html
```

### 3. View JSON Report

```bash
cat target/cucumber-reports/cucumber.json | jq
```

## Report Features

### Enhanced HTML Report Includes:

#### ğŸ“Š **Dashboard Overview**
- Total scenarios (passed/failed/skipped)
- Total steps (passed/failed/skipped/pending)
- Total features
- Overall pass rate
- Execution duration
- Trends over time

#### ğŸ“ **Features View**
- List of all feature files
- Scenarios per feature
- Pass/fail status per feature
- Duration per feature
- Expandable scenarios

#### ğŸ¯ **Scenarios View**
- All scenarios across features
- Status (passed/failed/skipped)
- Duration
- Tags
- Steps breakdown
- Error details for failures

#### ğŸ·ï¸ **Tags View**
- Scenarios grouped by tags
- Pass rate per tag
- Duration per tag
- Useful for tracking test categories

#### ğŸ“ **Steps View**
- All steps across all scenarios
- Most used steps
- Duration statistics
- Failure patterns

#### âš ï¸ **Failures View**
- All failed scenarios
- Error messages
- Stack traces
- Screenshots (if configured)

#### ğŸ“ˆ **Trends (if historical data available)**
- Pass rate trends
- Duration trends
- Flaky test detection

### Interactive Features:
- âœ… **Search and filter** scenarios
- âœ… **Expand/collapse** step details
- âœ… **Sort by** duration, status, name
- âœ… **Tag-based filtering**
- âœ… **Responsive design** for mobile/tablet
- âœ… **Printable reports**

## CI/CD Integration

### Azure DevOps Pipeline

The reports are automatically generated and published in the pipeline:

```yaml
# From azure-pipelines/build-backend.yml

- task: Maven@3
  displayName: 'Run integration tests'
  inputs:
    goals: 'verify'
    options: '-DskipUTs=true'

# Publish Cucumber reports
- task: PublishBuildArtifacts@1
  displayName: 'Publish Cucumber HTML reports'
  inputs:
    PathtoPublish: 'app/backend/target/cucumber-reports'
    ArtifactName: 'cucumber-reports'
  condition: succeededOrFailed()

- task: PublishTestResults@2
  displayName: 'Publish Cucumber test results'
  inputs:
    testResultsFormat: 'JUnit'
    testResultsFiles: '**/cucumber-reports/*.xml'
  condition: succeededOrFailed()
```

### Accessing Reports in Azure DevOps

1. Go to your pipeline run
2. Click on **Artifacts** tab
3. Download `cucumber-reports` artifact
4. Extract and open `cucumber-html-reports/overview-features.html`

## Sample Report

### Report Structure

```
target/cucumber-reports/
â”œâ”€â”€ cucumber.json                          # JSON report
â”œâ”€â”€ cucumber.html                          # Basic HTML report
â””â”€â”€ cucumber-html-reports/                 # Enhanced reports
    â”œâ”€â”€ overview-features.html             # â­ Main dashboard
    â”œâ”€â”€ overview-tags.html                 # Tags view
    â”œâ”€â”€ overview-steps.html                # Steps view
    â”œâ”€â”€ overview-failures.html             # Failures view
    â”œâ”€â”€ report-feature_*.html              # Individual feature reports
    â””â”€â”€ embeddings/                        # Screenshots/attachments
```

### Dashboard Example (Text Representation)

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    AKS Starter Backend - v1.0.0                    â•‘
â•‘                    Cucumber Test Report                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                     â•‘
â•‘  Build Number: 1.0.0                                               â•‘
â•‘  Date: 2024-01-15 10:30:00                                         â•‘
â•‘  Duration: 45.2 seconds                                            â•‘
â•‘                                                                     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  OVERALL STATISTICS                                                â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                     â•‘
â•‘  Features:          3                                              â•‘
â•‘  â”œâ”€ Passed:         3  [100%] â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                          â•‘
â•‘  â””â”€ Failed:         0                                              â•‘
â•‘                                                                     â•‘
â•‘  Scenarios:        18                                              â•‘
â•‘  â”œâ”€ Passed:        16  [89%]  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘                          â•‘
â•‘  â”œâ”€ Failed:         2  [11%]  â–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘                          â•‘
â•‘  â””â”€ Skipped:        0                                              â•‘
â•‘                                                                     â•‘
â•‘  Steps:            95                                              â•‘
â•‘  â”œâ”€ Passed:        88  [93%]  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–“                          â•‘
â•‘  â”œâ”€ Failed:         5  [5%]   â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘                          â•‘
â•‘  â”œâ”€ Skipped:        2  [2%]   â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘                          â•‘
â•‘  â””â”€ Pending:        0                                              â•‘
â•‘                                                                     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  FEATURES                                                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                     â•‘
â•‘  âœ… Hello API                         [100%] 15 scenarios          â•‘
â•‘     Duration: 12.5s                                                â•‘
â•‘                                                                     â•‘
â•‘  âš ï¸  User Management API              [89%]  18 scenarios          â•‘
â•‘     Duration: 28.3s                                                â•‘
â•‘     â”œâ”€ âœ… Create new user                                          â•‘
â•‘     â”œâ”€ âœ… Retrieve existing user                                   â•‘
â•‘     â”œâ”€ âœ… Retrieve all users                                       â•‘
â•‘     â”œâ”€ âŒ Delete user (Failed)                                     â•‘
â•‘     â””â”€ ... 14 more scenarios                                       â•‘
â•‘                                                                     â•‘
â•‘  âœ… Health Check API                  [100%] 3 scenarios           â•‘
â•‘     Duration: 4.4s                                                 â•‘
â•‘                                                                     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  TAGS                                                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                     â•‘
â•‘  @smoke:      4 scenarios [100% passed]                            â•‘
â•‘  @positive:  10 scenarios [100% passed]                            â•‘
â•‘  @negative:   8 scenarios [75% passed]                             â•‘
â•‘  @validation: 6 scenarios [83% passed]                             â•‘
â•‘  @security:   2 scenarios [100% passed]                            â•‘
â•‘                                                                     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  FAILURES (2)                                                      â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                     â•‘
â•‘  âŒ Feature: User Management API                                   â•‘
â•‘     Scenario: Delete non-existent user                             â•‘
â•‘     Step: Then the error message should contain "User not found"   â•‘
â•‘     Error: AssertionError: Expected message to contain             â•‘
â•‘            "User not found" but was "Resource not found"           â•‘
â•‘     Duration: 0.5s                                                 â•‘
â•‘                                                                     â•‘
â•‘  âŒ Feature: User Management API                                   â•‘
â•‘     Scenario: Create user with duplicate username                  â•‘
â•‘     Step: Then the response status code should be 422              â•‘
â•‘     Error: AssertionError: Expected 422 but was 500                â•‘
â•‘     Duration: 0.3s                                                 â•‘
â•‘                                                                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Individual Scenario Example

```
Scenario: Create a new user with valid data                    âœ… PASSED
Tags: @smoke, @positive
Duration: 1.2 seconds

Background:                                                     âœ… PASSED
  Given the application is running                              âœ… 0.1s
  And the database is clean                                     âœ… 0.05s

Steps:
  Given I am authenticated as "admin"                           âœ… 0.05s
  When I create a user with the following details:              âœ… 0.8s
    | username | email            | fullName  |
    | john_doe | john@example.com | John Doe  |
  Then the response status code should be 201                   âœ… 0.1s
  And the response should contain the user details              âœ… 0.05s
  And the user should have a valid ID                           âœ… 0.02s
  And the user should have a creation timestamp                 âœ… 0.03s
```

## Feature File Organization

### Current Features:

1. **`hello-api.feature`** - Basic API testing
   - Successful API call with authentication
   - API call without authentication
   - Public health endpoint

2. **`user-management.feature`** - Comprehensive CRUD operations
   - Create user (positive cases)
   - Retrieve user by ID
   - Retrieve all users
   - Delete user
   - Validation scenarios
   - Error handling scenarios
   - End-to-end scenarios

### Tag Strategy:

| Tag | Purpose | Example Use |
|-----|---------|-------------|
| `@smoke` | Quick sanity tests | Pre-deployment verification |
| `@positive` | Happy path scenarios | Main functionality tests |
| `@negative` | Error scenarios | Error handling validation |
| `@validation` | Input validation | API contract testing |
| `@security` | Security tests | Authentication/authorization |
| `@business` | Business logic | Complex workflows |
| `@slow` | Long-running tests | Performance tests |
| `@wip` | Work in progress | Development |

## Best Practices

### 1. Writing Scenarios

```gherkin
# Good - Clear, specific, business-focused
Scenario: Create user with invalid email format
  Given I am authenticated as "admin"
  When I attempt to create a user with username "valid_user" and email "invalid-email"
  Then the response status code should be 400
  And the error message should contain "Email must be valid"

# Avoid - Too technical, not business-focused
Scenario: POST /api/users returns 400
  When I POST to /api/users with bad data
  Then I get 400
```

### 2. Using Tags

```gherkin
@smoke @positive
Scenario: Core functionality test

@negative @validation
Scenario: Edge case test

@slow @performance
Scenario: Load test
```

### 3. Data Tables

```gherkin
# For multiple similar test cases
Scenario Outline: Create user with various invalid usernames
  When I attempt to create a user with username "<username>"
  Then the error message should contain "<error_message>"

  Examples:
    | username   | error_message        |
    | ab         | too short            |
    | user@name  | invalid characters   |
```

## Troubleshooting

### Issue: Reports Not Generated

**Solution:**
```bash
# Ensure tests actually run
mvn clean verify -X

# Check if JSON report exists
ls -la target/cucumber-reports/

# Manually trigger report generation
mvn net.masterthought:maven-cucumber-reporting:generate
```

### Issue: Empty Report

**Solution:**
- Verify Cucumber runner configuration
- Check that step definitions are found
- Ensure feature files are in correct location
- Check test execution logs

### Issue: Report Shows All Skipped

**Solution:**
- Verify `@CucumberContextConfiguration` is present
- Check Spring Boot test configuration
- Ensure database/dependencies are available

## Customization

### Customize Report Title

Edit `pom.xml`:
```xml
<configuration>
    <projectName>My Custom Project Name</projectName>
    <buildNumber>${project.version}</buildNumber>
</configuration>
```

### Add Custom Metadata

```xml
<configuration>
    <classifications>
        <classification>
            <key>Environment</key>
            <value>Test</value>
        </classification>
        <classification>
            <key>Browser</key>
            <value>API Tests</value>
        </classification>
    </classifications>
</configuration>
```

### Fail Build on Test Failure

```xml
<configuration>
    <checkBuildResult>true</checkBuildResult>
</configuration>
```

## Summary

âœ… **Multiple report formats** (Console, JSON, Basic HTML, Enhanced HTML)
âœ… **Beautiful interactive reports** with Masterthought
âœ… **Tag-based test organization** for flexible execution
âœ… **Comprehensive test coverage** with 18+ scenarios
âœ… **CI/CD integration** with Azure DevOps
âœ… **Detailed failure analysis** with stack traces
âœ… **Historical trends** (when configured)
âœ… **Mobile-responsive** report design

**View your reports**: `target/cucumber-reports/cucumber-html-reports/overview-features.html`

For more information:
- [Cucumber Documentation](https://cucumber.io/docs/cucumber/)
- [Cucumber Reporting Plugin](https://github.com/damianszczepanik/maven-cucumber-reporting)
- [Gherkin Syntax](https://cucumber.io/docs/gherkin/reference/)
